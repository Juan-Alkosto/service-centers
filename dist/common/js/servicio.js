/*! service-centers - v1.0.0 */
import{geocoder,infoWindow,app as map}from"./map.js";import Select from"./select.js";import ServiceCenter from"./service-center.js";(()=>{const e={get:async(e="")=>{if(e.length)return await fetch(e,{cache:"force-cache",mode:"cors"}).then(e=>e.json()).then(e=>e)},map:{init:async()=>p=await map.init("#service-centers-map")},menu:{render:({active:e,address:n,cellphone:t,email:s,hours:o,id:i,name:a,phone:c})=>`<div class="service-centers__menu__item">\n                    <input type="radio" name="centro-servicio" id="${i}" ${e?"checked":""}>\n                    <label for="${i}">${a}</label>\n                    <div class="service-centers__menu__item__body">\n                        <div class="schedules">\n                            <p><strong>Lunes a Viernes:</strong>\n                                11:00 a.m  - 3:00 p.m.</p>\n                            <p><strong>S치bados:</strong>\n                                11:00 a.m - 3:00 p.m.</p>\n                        </div>\n                        <div class="address">\n                            <p><strong>Direcci칩n:</strong>\n                                ${n}</p>\n                        </div>\n                        <div class="email">\n                            <p><strong>Correo electr칩nico:</strong>\n                                <a href="mailto:${s}" target="_blank" rel="nooppener">${s}</a>\n                            </p>\n                        </div>\n                        ${null!==c?`<div class="phone">\n                            <p><strong>Contacto telef칩nico:</strong>\n                                ${c}</p>\n                        </div>`:""}\n                        ${null!==t?`<div class="cell">\n                            <p><strong>Celular:</strong>\n                                ${t}</p>\n                        </div>`:""}\n                    </div>\n                </div>`},select:{init:()=>document.querySelectorAll("[data-custom-select").forEach(e=>new Select(e))}},n=document.getElementById("departamento"),t=document.getElementById("ciudad"),s=document.getElementById("categoria"),o=new Option(`Selecciona un ${n.labels[0].textContent.toLowerCase()}`,0,!0,!0),i=new Option(`Selecciona una ${t.labels[0].textContent.toLowerCase()}`,0,!0,!0),a=new Option(`Selecciona una ${s.labels[0].textContent.toLowerCase()}`,0,!0,!0),c=document.querySelector(".service-centers__menu"),r=new Event("updated");let p,d=!0,l=[],m=[];async function v({servicePointsCodes:e,stores:n}){return e=[...new Set(e)],await e.map(e=>{let t={id:e,coordinates:{lat:n[e].lat,lng:n[e].lng}};return t={...t,...n[e]},new ServiceCenter(t)})}async function u(e){const n=new google.maps.LatLngBounds;l.map(e=>e.setMap(null)),e.map(e=>{const t=new google.maps.Marker({position:new google.maps.LatLng(e.coordinates.lat,e.coordinates.lng),map:p,icon:`/dist/${serviceCentersConfig.site}/img/pin.svg`});n.extend(t.getPosition()),l.push(t)}),p.setCenter(n.getCenter()),p.fitBounds(n),p.getZoom()>18&&p.setZoom(18)}function g(n){c.innerHTML="",n.map(n=>(n.activeCenter=d,d=!1,c.insertAdjacentHTML("beforeend",e.menu.render(n))))}n.append(o),t.append(i),s.append(a),void 0!==serviceCentersConfig.jsonFile&&e.get(serviceCentersConfig.jsonFile).then(async({categories:o,cities:c,stores:l})=>{await e.map.init().then(()=>{infoWindow.setPosition(p.getCenter()),infoWindow.setContent("Selecciona un departamento"),infoWindow.open(p)}),Object.entries(c).map(e=>{const t=e[1],s=e[0],o=new Option(t.name,s);n.append(o)}),e.select.init(),n.addEventListener("change",async()=>{d=!0,t.innerHTML="",t.append(i),infoWindow.close(),Object.values(c[n.value].cities).map(({categories:e})=>Object.values(e).map(({stores:e})=>e.map(e=>{m.push(e)}))),v({servicePointsCodes:m,stores:l}).then(e=>{g(e),u(e)}),Object.entries(c[n.value].cities).map(e=>{const n=e[1],s=e[0],o=new Option(n.name,s);t.append(o)}),t.dispatchEvent(r),s.innerHTML="",s.append(a),s.dispatchEvent(r),m=[]}),t.addEventListener("change",()=>{d=!0,s.innerHTML="",s.append(a),Object.values(c[n.value].cities[t.value].categories).map(({stores:e})=>e.map(e=>{m.push(e)})),v({servicePointsCodes:m,stores:l}).then(e=>{g(e),u(e)}),Object.entries(c[n.value].cities[t.value].categories).map(e=>{const n=o[e[0]].name,t=e[0],i=new Option(n,t);s.append(i)}),s.dispatchEvent(r),m=[]}),s.addEventListener("change",()=>{d=!0,Object.values(c[n.value].cities[t.value].categories[s.value].stores).map(e=>{m.push(e)}),v({servicePointsCodes:m,stores:l}).then(e=>{g(e),u(e)}),m=[]})})})();