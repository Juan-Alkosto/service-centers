/*! service-centers - v1.0.0 */
import Map from"./map.js";import Select from"./select.js";import ServiceCenter from"./service-center.js";(()=>{const e={get:async(e="")=>{if(e.length)return await fetch(e,{cache:"force-cache",mode:"cors"}).then(e=>e.json()).then(e=>e)},map:{init:async()=>{l=new Map({$element:"#service-centers-map",baseSite:appConfig.site})}},menu:{render:({active:e,address:n,cellphone:t,id:a,map:r,name:s,phone:i})=>`<div class="service-centers__menu__item">\n                    <input type="radio" name="centro-servicio" id="${a}" ${e?"checked":""}>\n                    <label for="${a}">${s}<span class="${e?"alk-icon-arrow-up":"alk-icon-arrow-down"}"></span></label>\n                    <div class="service-centers__menu__item__body" data-service-center="${a}">\n                        <div class="address">\n                            <p><strong>Dirección:</strong>\n                                ${n}</p>\n                        </div>\n                        <div class="contact-phones">\n                            ${i.length?`<div class="phone">\n                                <p><strong>Contacto telefónico:</strong>\n                                    ${i.map(e=>`<a href="tel:+57${e.replace(/\s/g,"")}" title="Llamar a ${s}">${e}</a>`)}\n                                </p>\n                            </div>`:""}\n                            ${t.length?`<div class="cell">\n                                <p><strong>Celular:</strong>\n                                    ${t.map(e=>`<a href="tel:+57${e.replace(/\s/g,"")}" title="Llamar a ${s}">${e}</a>`)}\n                                </p>\n                            </div>`:""}\n                        </div>\n                        <div class="how-to-get">\n                            <p>\n                                <a rel="noopener" href="${r}" title="Indicaciones para llegar a ${s}">¿Cómo llegar?</a>\n                            </p>\n                        </div>\n                    </div>\n                </div>`,toogleArrow:()=>{const e=document.querySelectorAll(".service-centers__menu__item > input");e.forEach(n=>{n.addEventListener("change",n=>{e.forEach(e=>{const t=e.nextElementSibling.querySelector("span");n.target===e?t.classList.replace("alk-icon-arrow-down","alk-icon-arrow-up"):t.classList.replace("alk-icon-arrow-up","alk-icon-arrow-down")})})})},animateMarker:()=>{document.querySelectorAll(".service-centers__menu__item__body").forEach(e=>{e.addEventListener("mouseenter",()=>{l.bounceMarker(e.dataset.serviceCenter,"start")}),e.addEventListener("mouseleave",()=>{l.bounceMarker(e.dataset.serviceCenter,"stop")})})}},select:{init:()=>document.querySelectorAll("[data-custom-select").forEach(e=>new Select(e))}},n=document.getElementById("departamento"),t=document.getElementById("ciudad"),a=document.getElementById("categoria"),r=new Option(`Selecciona un ${n.labels[0].textContent.toLowerCase()}`,0,!0,!0),s=new Option(`Selecciona una ${t.labels[0].textContent.toLowerCase()}`,0,!0,!0),i=new Option(`Selecciona una ${a.labels[0].textContent.toLowerCase()}`,0,!0,!0),o=document.querySelector(".service-centers__menu"),c=new Event("updated");let l,p=!0,d=[];async function m({servicePointsCodes:e,serviceCenters:n}){return e=[...new Set(e)],await e.map(e=>{let t={id:e,coordinates:{lat:n[e].lat,lng:n[e].lng}};return t={...t,...n[e]},new ServiceCenter(t)})}function u(n){o.innerHTML="",n.map(n=>(n.active=p,p=!1,o.insertAdjacentHTML("beforeend",e.menu.render(n))))}n.append(r),t.append(s),a.append(i),void 0!==appConfig.jsonFile&&e.get(appConfig.jsonFile).then(async({categories:r,departments:o,serviceCenters:v})=>{await e.map.init().then(()=>{l.infoWindow.setPosition(l.map.getCenter()),l.infoWindow.setContent("Selecciona un departamento"),l.infoWindow.open(l.map)}),Object.entries(o).map(e=>{const t=e[1],a=e[0],r=new Option(t.name,a);n.append(r)}),e.select.init(),n.addEventListener("change",async()=>{p=!0,t.innerHTML="",t.append(s),l.infoWindow.close(),Object.values(o[n.value].cities).map(({categories:e})=>Object.values(e).map(({stores:e})=>e.map(e=>{d.push(e)}))),m({servicePointsCodes:d,serviceCenters:v}).then(n=>{u(n),l.setMarkers(n),e.menu.toogleArrow(),e.menu.animateMarker()}),Object.entries(o[n.value].cities).map(e=>{const n=e[1],a=e[0],r=new Option(n.name,a);t.append(r)}),t.dispatchEvent(c),a.innerHTML="",a.append(i),a.dispatchEvent(c),d=[]}),t.addEventListener("change",()=>{p=!0,a.innerHTML="",a.append(i),Object.values(o[n.value].cities[t.value].categories).map(({stores:e})=>e.map(e=>{d.push(e)})),m({servicePointsCodes:d,serviceCenters:v}).then(n=>{u(n),l.setMarkers(n),e.menu.toogleArrow(),e.menu.animateMarker()}),Object.entries(o[n.value].cities[t.value].categories).map(e=>{const n=r[e[0]].name,t=e[0],s=new Option(n,t);a.append(s)}),a.dispatchEvent(c),d=[]}),a.addEventListener("change",()=>{p=!0,Object.values(o[n.value].cities[t.value].categories[a.value].stores).map(e=>{d.push(e)}),m({servicePointsCodes:d,serviceCenters:v}).then(n=>{u(n),l.setMarkers(n),e.menu.toogleArrow(),e.menu.animateMarker()}),d=[]})})})();