/*! service-centers - v1.0.4 */
"use strict";import Map from"./map.js";import Select from"./select.js";import ServiceCenter from"./service-center.js";((e,n)=>{const t={get:async(e="")=>{if(e.length)return await fetch(e,{cache:"force-cache",mode:"cors"}).then(e=>e.json()).then(e=>e)},map:{init:async()=>{u=new Map({$element:"#service-centers-map",baseSite:a.site}),n.addEventListener("click",e=>{e.target.classList.contains("service-centers__map__info-window__close")&&u.infoWindow.close()}),e.onresize=(()=>{e.innerWidth>p&&"0"!=n.getElementById("departamento").value?n.querySelector(".service-centers__map").style.display="block":n.querySelector(".service-centers__map").style.display="none"})}},menu:{render:({active:e,address:n,areaCode:t,cellphone:a,id:r,map:s,name:c,phone:i})=>{let o="",l="";for(const e of i)o+=`<a href="tel:+57${t}${e.replace(/\s/g,"")}" title="Llamar a ${c}">${e}</a>`;for(const e of a)l+=`<a href="tel:+57${e.replace(/\s/g,"")}" title="Llamar a ${c}">${e}</a>`;return`<div class="service-centers__menu__item">\n                    <input type="radio" name="centro-servicio" id="${r}" ${e?"checked":""}>\n                    <label for="${r}">${c}<span class="${e?"alk-icon-arrow-up":"alk-icon-arrow-down"}"></span></label>\n                    <div class="service-centers__menu__item__body" data-service-center="${r}">\n                        <div class="address">\n                            <p><strong><i class="alk-icon-rounded-position"></i> Dirección:</strong>\n                                ${n}</p>\n                        </div>\n                        <div class="contact-phones">\n                            ${i.length?`<div class="phone">\n                                <p><strong><i class="alk-icon-customer-contact"></i> Contacto telefónico:</strong>\n                                    ${o}\n                                </p>\n                            </div>`:""}\n                            ${a.length?`<div class="cell">\n                                <p><strong><i class="alk-icon-phone-contact"></i> Celular:</strong>\n                                    ${l}\n                                </p>\n                            </div>`:""}\n                        </div>\n                        <div class="how-to-get">\n                            <p>\n                                <i class="alk-icon-arrive"></i><a rel="noopener" href="${s}" title="Indicaciones para llegar a ${c}" target="_blank">¿Cómo llegar?</a>\n                            </p>\n                        </div>\n                    </div>\n                </div>`},toogleArrow:()=>{const e=n.querySelectorAll(".service-centers__menu__item > input");e.forEach(n=>{n.addEventListener("change",n=>{e.forEach(e=>{const t=e.nextElementSibling.querySelector("span");n.target===e?t.classList.replace("alk-icon-arrow-down","alk-icon-arrow-up"):t.classList.replace("alk-icon-arrow-up","alk-icon-arrow-down")})})})},animateMarker:()=>{n.querySelectorAll(".service-centers__menu__item__body").forEach(e=>{e.addEventListener("mouseenter",()=>{u.bounceMarker(e.dataset.serviceCenter,"start")}),e.addEventListener("mouseleave",()=>{u.bounceMarker(e.dataset.serviceCenter,"stop")})})}},select:{init:()=>n.querySelectorAll("[data-custom-select").forEach(e=>new Select(e))}},a=appConfig||{},r=n.getElementById("departamento"),s=n.getElementById("ciudad"),c=n.getElementById("categoria"),i=new Option(`Selecciona un ${r.labels[0].textContent.toLowerCase()}`,0,!0,!0),o=new Option(`Selecciona una ${s.labels[0].textContent.toLowerCase()}`,0,!0,!0),l=new Option(`Selecciona una ${c.labels[0].textContent.toLowerCase()}`,0,!0,!0),d=n.querySelector(".service-centers__menu"),p=Number(getComputedStyle(n.documentElement).getPropertyValue("--service-centers-breakpoint").replace("px",""));let u,v=!0,m=[];async function g({servicePointsCodes:e,serviceCenters:n}){let t="",a=[];return e.map(({code:e,areaCode:n})=>{a.push(e),t=n}),e=[...new Set(a)],await e.map(e=>{let a={id:e,areaCode:t,coordinates:{lat:n[e].lat,lng:n[e].lng}};return a={...a,...n[e]},new ServiceCenter(a)})}function h(e){d.innerHTML="",u.setMarkers(e),e.map(e=>(e.active=v,v=!1,d.insertAdjacentHTML("beforeend",t.menu.render(e)))),t.menu.toogleArrow(),t.menu.animateMarker()}r.append(i),s.append(o),c.append(l),s.disabled=!0,c.disabled=!0,void 0!==a.jsonFile&&t.get(a.jsonFile).then(async({categories:a,departments:i,serviceCenters:d})=>{await t.map.init(),Object.entries(i).map(e=>{const n=e[1],t=e[0],a=new Option(n.name,t);r.append(a)}),t.select.init(),n.addEventListener("updateCenter",e=>{const t=e.detail.center;if(null!==t){const e=n.getElementById(t);e.click(),setTimeout(()=>n.querySelector(".service-centers__menu").scrollTop=e.offsetTop,250)}}),r.addEventListener("change",async()=>{v=!0,s.innerHTML="",s.append(o),u.infoWindow.close(),e.innerWidth>p&&(n.querySelector(".service-centers__map").style.display="block"),n.querySelector(".msje-localiza").innerText="Localiza los centros de servicio técnico:",Object.values(i[r.value].cities).map(({areaCode:e,categories:n})=>Object.values(n).map(({stores:n})=>n.map(n=>{const t={code:n,areaCode:e};return m.push(t)}))),await g({servicePointsCodes:m,serviceCenters:d}).then(e=>h(e)),Object.entries(i[r.value].cities).map(e=>{const n=e[1],t=e[0],a=new Option(n.name,t);s.append(a)}),s.disabled=!1,s.refresh(),c.innerHTML="",c.disabled=!0,c.append(l),c.refresh(),m=[]}),s.addEventListener("change",async()=>{v=!0,c.innerHTML="",c.append(l),Object.values(i[r.value].cities[s.value].categories).map(({stores:e})=>e.map(e=>{const n={code:e,areaCode:i[r.value].cities[s.value].areaCode};return m.push(n)})),await g({servicePointsCodes:m,serviceCenters:d}).then(e=>h(e)),Object.entries(i[r.value].cities[s.value].categories).map(e=>{const n=a[e[0]].name,t=e[0],r=new Option(n,t);c.append(r)}),c.disabled=!1,c.refresh(),m=[]}),c.addEventListener("change",async()=>{v=!0,Object.values(i[r.value].cities[s.value].categories[c.value].stores).map(e=>{const n={code:e,areaCode:i[r.value].cities[s.value].areaCode};return m.push(n)}),await g({servicePointsCodes:m,serviceCenters:d}).then(e=>h(e)),m=[]})})})(window,document);